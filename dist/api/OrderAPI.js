"use strict";

var cov_2m6ha5bwzv = function () {
  var path = "/Users/johnsgreenlandjr/go/src/github.com/ndau/ndaujs/src/api/OrderAPI.js";
  var hash = "891bf3a0c20a2d990f10d0b8080e39633a8bc1b9";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/johnsgreenlandjr/go/src/github.com/ndau/ndaujs/src/api/OrderAPI.js",
    statementMap: {
      "0": {
        start: {
          line: 15,
          column: 10
        },
        end: {
          line: 15,
          column: 46
        }
      },
      "1": {
        start: {
          line: 17,
          column: 23
        },
        end: {
          line: 41,
          column: 1
        }
      },
      "2": {
        start: {
          line: 18,
          column: 25
        },
        end: {
          line: 18,
          column: 74
        }
      },
      "3": {
        start: {
          line: 19,
          column: 2
        },
        end: {
          line: 38,
          column: 3
        }
      },
      "4": {
        start: {
          line: 20,
          column: 17
        },
        end: {
          line: 20,
          column: 65
        }
      },
      "5": {
        start: {
          line: 22,
          column: 20
        },
        end: {
          line: 22,
          column: 80
        }
      },
      "6": {
        start: {
          line: 27,
          column: 4
        },
        end: {
          line: 30,
          column: 5
        }
      },
      "7": {
        start: {
          line: 28,
          column: 6
        },
        end: {
          line: 28,
          column: 44
        }
      },
      "8": {
        start: {
          line: 28,
          column: 26
        },
        end: {
          line: 28,
          column: 44
        }
      },
      "9": {
        start: {
          line: 29,
          column: 6
        },
        end: {
          line: 29,
          column: 41
        }
      },
      "10": {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 32,
          column: 18
        }
      },
      "11": {
        start: {
          line: 34,
          column: 4
        },
        end: {
          line: 34,
          column: 57
        }
      },
      "12": {
        start: {
          line: 35,
          column: 4
        },
        end: {
          line: 37,
          column: 5
        }
      },
      "13": {
        start: {
          line: 36,
          column: 6
        },
        end: {
          line: 36,
          column: 38
        }
      },
      "14": {
        start: {
          line: 40,
          column: 2
        },
        end: {
          line: 40,
          column: 10
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 17,
            column: 23
          },
          end: {
            line: 17,
            column: 24
          }
        },
        loc: {
          start: {
            line: 17,
            column: 37
          },
          end: {
            line: 41,
            column: 1
          }
        },
        line: 17
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 30,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 30,
            column: 5
          }
        }, {
          start: {
            line: 27,
            column: 4
          },
          end: {
            line: 30,
            column: 5
          }
        }],
        line: 27
      },
      "1": {
        loc: {
          start: {
            line: 27,
            column: 8
          },
          end: {
            line: 27,
            column: 23
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 27,
            column: 8
          },
          end: {
            line: 27,
            column: 12
          }
        }, {
          start: {
            line: 27,
            column: 16
          },
          end: {
            line: 27,
            column: 23
          }
        }],
        line: 27
      },
      "2": {
        loc: {
          start: {
            line: 28,
            column: 6
          },
          end: {
            line: 28,
            column: 44
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 28,
            column: 6
          },
          end: {
            line: 28,
            column: 44
          }
        }, {
          start: {
            line: 28,
            column: 6
          },
          end: {
            line: 28,
            column: 44
          }
        }],
        line: 28
      },
      "3": {
        loc: {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }, {
          start: {
            line: 35,
            column: 4
          },
          end: {
            line: 37,
            column: 5
          }
        }],
        line: 35
      },
      "4": {
        loc: {
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 35,
            column: 50
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 35,
            column: 8
          },
          end: {
            line: 35,
            column: 21
          }
        }, {
          start: {
            line: 35,
            column: 25
          },
          end: {
            line: 35,
            column: 50
          }
        }],
        line: 35
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0]
    },
    _coverageSchema: "43e27e138ebf9cfc5966b082cf9a028302ed4184",
    hash: "891bf3a0c20a2d990f10d0b8080e39633a8bc1b9"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return coverage[path] = coverageData;
}();

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _APIAddressHelper = _interopRequireDefault(require("../api/helpers/APIAddressHelper.js"));

var _APICommunicationHelper = _interopRequireDefault(require("../api/helpers/APICommunicationHelper.js"));

var _DataFormatHelper = _interopRequireDefault(require("../api/helpers/DataFormatHelper.js"));

var _LoggerHelper = _interopRequireDefault(require("../helpers/LoggerHelper.js"));

var l = (cov_2m6ha5bwzv.s[0]++, _LoggerHelper["default"].curryLogger('OrderAPI'));
cov_2m6ha5bwzv.s[1]++;

var getMarketPrice = /*#__PURE__*/function () {
  var _ref = (0, _asyncToGenerator2["default"])( /*#__PURE__*/_regenerator["default"].mark(function _callee(user) {
    var marketPriceAPI, data, dollars;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            cov_2m6ha5bwzv.f[0]++;
            cov_2m6ha5bwzv.s[2]++;
            _context.next = 4;
            return _APIAddressHelper["default"].getMarketPriceAPIAddress();

          case 4:
            marketPriceAPI = _context.sent;
            cov_2m6ha5bwzv.s[3]++;
            _context.prev = 6;
            cov_2m6ha5bwzv.s[4]++;
            _context.next = 10;
            return _APICommunicationHelper["default"].get(marketPriceAPI);

          case 10:
            data = _context.sent;
            dollars = (cov_2m6ha5bwzv.s[5]++, _DataFormatHelper["default"].convertNanoCentsToDollars(data.marketPrice)); // set the marketPrice to the user to cache this value with
            // the user. The marketPrice is captured in a defaults object
            // only if dollars is truthy (not 0 mainly)

            cov_2m6ha5bwzv.s[6]++;

            if ((cov_2m6ha5bwzv.b[1][0]++, user) && (cov_2m6ha5bwzv.b[1][1]++, dollars)) {
              cov_2m6ha5bwzv.b[0][0]++;
              cov_2m6ha5bwzv.s[7]++;

              if (!user.defaults) {
                cov_2m6ha5bwzv.b[2][0]++;
                cov_2m6ha5bwzv.s[8]++;
                user.defaults = {};
              } else {
                cov_2m6ha5bwzv.b[2][1]++;
              }

              cov_2m6ha5bwzv.s[9]++;
              user.defaults.marketPrice = dollars;
            } else {
              cov_2m6ha5bwzv.b[0][1]++;
            }

            cov_2m6ha5bwzv.s[10]++;
            return _context.abrupt("return", dollars);

          case 18:
            _context.prev = 18;
            _context.t0 = _context["catch"](6);
            cov_2m6ha5bwzv.s[11]++;
            l.debug("could not fetch market price: ".concat(_context.t0.message));
            cov_2m6ha5bwzv.s[12]++;

            if (!((cov_2m6ha5bwzv.b[4][0]++, user.defaults) && (cov_2m6ha5bwzv.b[4][1]++, user.defaults.marketPrice))) {
              _context.next = 29;
              break;
            }

            cov_2m6ha5bwzv.b[3][0]++;
            cov_2m6ha5bwzv.s[13]++;
            return _context.abrupt("return", user.defaults.marketPrice);

          case 29:
            cov_2m6ha5bwzv.b[3][1]++;

          case 30:
            cov_2m6ha5bwzv.s[14]++;
            return _context.abrupt("return", 0);

          case 32:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[6, 18]]);
  }));

  return function getMarketPrice(_x) {
    return _ref.apply(this, arguments);
  };
}();

var _default = {
  getMarketPrice: getMarketPrice
};
exports["default"] = _default;